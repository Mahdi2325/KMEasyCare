<!--社工服务记录-->

<div class="row">
    <div id="content" class="col-md-12">
        <div class="row">
            <div class="col-sm-12">
                <div class="page-header">
                    <!-- BREADCRUMBS -->
                    <ul class="breadcrumb">
                        <li>
                            <i class="fa fa-home"></i>
                            <a href="/">首页</a>
                        </li>

                        <li>社工服务记录</li>
                    </ul>
                    <!-- /BREADCRUMBS -->
                    <!--<div class="clearfix"></div>
                    -->
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="col-sm-2">
                    <div class="box border primary">
                        <div class="box-title">
                            <h4>
                                <i class="fa fa-bars"></i>住民信息
                            </h4>
                        </div>
                        <div class="box-body">
                            <resident-card feeno={{FeeNo}} callback="residentSelected(resident)" />
                        </div>
                    </div>
                </div>
                <div class="col-md-10">
                    <div class="box border primary">
                        <div class="box-title">
                            <h4><i class="fa fa-columns"></i><span class="hidden-inline-mobile">社工服务记录视窗</span></h4>
                        </div>
                        <div class="box-body">
                            <form class="form-horizontal" name="crForm" role="form" novalidate>
                                <div class="form-group">
                                    <label for="selRecordBy" class="col-sm-1 control-label">服务人员<span class="required">*</span></label>
                                    <div class="col-sm-2">
                                        <!--<select class="form-control" id="selNextEvaluator" ng-model="currentItem.Carer" ng-options="t.EmpNo as t.EmpName for t in Data.EmpList" required>
                                            <option value="">-- 请选择 --</option>
                                        </select>-->
                                        <input-staff callback="staffSelected(item)" value="{{currentItem.Carer}}" name="服务人员" required=true />
                                    </div>
                                    <label for="dtRecDate" class="col-sm-1 control-label">服务日期<span class="required">*</span></label>
                                    <div class="col-sm-2">
                                        <input type="text" class="form-control" ca-date-picker id="dtRecDate" ng-model="currentItem.RecDate" name="服务日期" required>
                                    </div>

                                </div>
                                <div class="form-group">
                                    <label for="selSvrAddress" class="col-sm-1 control-label">服务地点<span class="required">*</span></label>
                                    <div class="col-sm-2">
                                        <select class="form-control" id="selSvrAddress" ng-model="currentItem.SvrAddress" select-code="K00.017" name="服务地点" required>
                                            <option value="">-- 请选择 --</option>
                                        </select>
                                    </div>
                                    <label for="txtUnitContactor" class="col-sm-1 control-label">服务方式<span class="required">*</span></label>
                                    <div class="col-sm-2">
                                        <select class="form-control" id="selSvrAddress" ng-model="currentItem.SvrType" select-code="E00.215" name="服务方式" required>
                                            <option value="">-- 请选择 --</option>
                                        </select>
                                    </div>
                                    <label for="txtUnitAddress" class="col-sm-1 control-label">服务对象<span class="required">*</span></label>
                                    <!--<div class="col-sm-2">
                                        <input type="text" class="form-control" ng-model="currentItem.SvrPeople" ng-maxlength="50" name="服务对象" name="服务对象" required />
                                    </div>-->
                                    <div class="col-sm-2" id="ContNamediv">
                                        <div style="position:relative;">
                                            <span id="spanwidth" style="width:18px;overflow:hidden;">
                                                <select class="comboText" style="height:34px; padding-left:10px;" id="selContName" ng-model="currentItem.SvrPeople" name="服务对象" ng-change="change()">
                                                    <option ng-repeat="item in Data.ContactList" value="{{item.Name}}" conttel="{{item.Phone}}" contrel="{{item.Contrel}}">{{item.Name}}
                                                </select>
                                            </span>
                                            <input name="box" id="inputwidth" ng-maxlength="20" class="comboText" ng-model="currentItem.SvrPeople" style="position:absolute;left:0px; padding-left:10px; height:34px;">
                                        </div>
                                    </div>
                                    <label for="txtUnitTel" class="col-sm-1 control-label">对象类别<span class="required">*</span></label>
                                    <div class="col-sm-2">
                                        <!--<select class="form-control" id="selRelationType" ng-model="currentItem.RelationType" select-code="E00.216" name="对象类别" required>
                                            <option value="">-- 请选择 --</option>
                                        </select>-->
                                        <input type="text" class="form-control" ng-model="currentItem.RelationType" select-items="对象类别" ng-maxlength="200" />
                                    </div>
                                </div>


                                <div class="form-group">
                                    <label class="control-label col-md-1">问题层面<span class="required">*</span></label>
                                    <div class="col-md-2">
                                        <select class="form-control" required ng-model="currentItem.QuestionLevel" name="问题层面" ng-change="changeLevel(currentItem.QuestionLevel)" ng-options="item.ItemCode as item.ItemName for item in Data.Level" required>
                                        </select>
                                    </div>
                                    <label class="control-label col-md-1">问题焦点</label>
                                    <div class="col-md-8">
                                        <select class="form-control" id="selQuestionFocus" ng-model="currentItem.QuestionFocus" ng-change="changeQuestion(currentItem.QuestionFocus)" ng-options="item.ItemCode as item.ItemName for item in Data.Diag">
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-1">服务焦点说明</label>
                                    <div class="col-md-11">
                                        <textarea class="form-control" rows="3" ng-model="currentItem.QuestionDesc" select-items="服务焦点说明" ng-maxlength="50" name="服务焦点说明"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-1">处理措施</label>
                                    <div class="col-md-11">
                                        <select class="form-control" id="selRelationType" ng-model="currentItem.ProcessActivity" ng-maxlength="500" name="处理措施" ng-options="item.ItemCode as item.ItemName for item in Data.CarePlanActivityList">
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-1">处理说明</label>
                                    <div class="col-md-11">
                                        <textarea class="form-control" rows="3" ng-model="currentItem.TreatDesc" select-items="说明与备注" ng-maxlength="500" name="处遇说明"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-1">评估结果</label>
                                    <div class="col-md-2">
                                        <select class="form-control" id="selRelationType" ng-model="currentItem.EvalStatus" select-code="E00.217">
                                            <option value="">-- 请选择 --</option>
                                        </select>
                                    </div>
                                    <label class="control-label col-md-1">服务分钟</label>
                                    <div class="col-sm-2">
                                        <div class="input-group">
                                            <input type="number" class="form-control" ng-model="currentItem.EvalMinutes" min="0" onkeyup="if (this.value.length == 1) { this.value = this.value.replace(/[^1-9]/g, '') } else { this.value = this.value
        .replace(/\D/g, '') }"
                                                   onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'0')}else{this.value=this.value.replace(/\D/g,'')}" />
                                            <div class="input-group-addon">分钟</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-1">评估说明</label>
                                    <div class="col-md-11">
                                        <textarea class="form-control" rows="3" ng-model="currentItem.EvalDesc" select-items="本次服务评估" name="评估说明" ng-maxlength="50"></textarea>
                                    </div>

                                </div>
                                <div class="form-group">

                                    <div class="pull-right">
                                        <div class="btn-group" role="group" aria-label="...">
                                            <button class="btn btn-primary" ng-click="saveCarersvr(currentItem)">保存</button>&nbsp;
                                            <button type="button" class="btn btn-default" ng-click="currentItem={}" ng-disabled="crForm.$invalid">重置</button>
                                        </div>

                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="box border primary">
                        <div class="box-title">
                            <h4><i class="fa fa-table"></i>社工服务历史记录</h4>
                        </div>
                        <div class="box-body">
                            <ui-data-table options="options">
                                <table id="tbEvalList" class="table table-striped table-bordered table-hover table-handler">

                                    <thead>
                                        <tr>

                                            <th class="col-sm-1">服务日期</th>
                                            <th class="col-sm-1">服务人员</th>
                                            <th class="col-sm-1">服务地点</th>
                                            <th class="col-sm-1">服务方式</th>
                                            <th class="col-sm-1">服务对象</th>
                                            <th class="col-sm-1">对象类别</th>
                                            <th class="col-sm-1">问题层面</th>
                                            <th class="col-sm-1">评估结果</th>
                                            <th class="col-sm-1">服务分钟</th>
                                            <th class="col-sm-1">服务焦点说明</th>

                                            <th class="col-sm-1">评估说明</th>
                                            <th class="col-sm-1"><i class="fa fa-bars"></i> 操作</th>


                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr ng-repeat="item in carersvrs">
                                            <td>{{item.RecDate | dateFormat}}</td>
                                            <td>{{item.CarerName}}</td>
                                            <td><span select-code="K00.017" select-value="{{item.SvrAddress}}"></span></td>
                                            <td><span select-code="E00.215" select-value="{{item.SvrType}}"></span></td>

                                            <td>{{item.SvrPeople}}</td>
                                            <td><span select-code="E00.216" select-value="{{item.RelationType}}"></span></td>
                                            <td><span ng-bind="item.QuestionLevel"></span></td>
                                            <td><span select-code="E00.217" select-value="{{item.EvalStatus}}"></span></td>
                                            <td>{{item.EvalMinutes}}</td>
                                            <td>{{item.QuestionDesc|cut:true:8:'..'}}</td>
                                            <td>{{item.EvalDesc|cut:true:8:'..'}}</td>
                                            <td>
                                                <div class="btn-group btn-group-xs" role="group" aria-label="...">
                                                    <button class="btn btn-primary" ng-click="editOrCreate(item)">编辑</button>
                                                    <a class="btn btn-primary" role="button" data-toggle="modal" ng-click="carersvrDelete(item)">删除</a>
                                                    <a class="btn btn-warning" role="button" href="/Report/Preview?templateName=P14Report&key={{item.Id}}" target="_blank">打印</a>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>

                                </table>
                            </ui-data-table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(".datepicker").datepicker({
        dateFormat: "yy-mm-dd",
        changeMonth: true,
        changeYear: true
    });
</script>
